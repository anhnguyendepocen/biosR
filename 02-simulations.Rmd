# Simulations

In this chapter you'll learn how to conduct a simulation study. The word _simulation_ gets thrown around alot as a trivial concept, though I have found that this term is often either misused by epidemiologists or abused by statisticians. A source of this confusion arises from the fact that it is not well defined. This is not by accident. A simulation study has so many moving parts that it would be impossible to characterize in a single word. However, there are some common underlying themes behind simulation studies. For this reason, the main focus here will be on creating a general roadmap for conducting these types of analyses, that can be applied to your specific setting. 


## What is a simulation study?

Here are some results from a Google Search:

1. A numerical technique for conducting experiments on the computer [@marie]
2. Simulations provide a powerful technique for answering a broad set of methodological and theoretical questions and provide a flexible framework to answer specific questions relevant to one's own research[@hallgren2013conducting]

I prefer the second definition because it speaks to the generality of simulations. I see simulations in the following way^[All flowcharts are created using the `DiagrammeR` pacakge [@R-DiagrammeR]]:

```{r, echo=FALSE}
DiagrammeR::mermaid("
graph LR
A((Input 1))-->B{Procedure}
D((Input 2))-->B{Procedure}
E((Input 3))-->B{Procedure}
B-->C[Output 1]
B-->F[Output 1]
B-->G[Output 1]
")
```

There are three crucial components to any simulation study: 

1. **Procedure** - something that doesn't change throughout the simulation study
2. **Input**: _several_ values of the same quantity that are passed to the procedure. 
3. **Output**: result from the procedure being applied to the inputs. Should be equal in length to the number of outputs. The following toy example illustrates this point:

```{r, echo=-1}
set.seed(123)
f_sample_median <- function(true_mean) {
  x <- rnorm(20, mean = true_mean, sd = 1)
  median(x)
}

(means <- c(1,2,3))

(sample_medians <- sapply(means, f_sample_median))
```

So here, `f_sample_median` is the procedure that generates 20 random numbers from a normal distribution with standard deviation 1 and a user specified mean, and outputs the sample median. `means` is the input vector of user specified means, and `sample_medians` is the output:

```{r, echo=FALSE}
DiagrammeR::mermaid("
graph LR
A((1))-->B{f_sample_median}
D((2))-->B
E((3))-->B
B-->C[1.12]
B-->F[1.86]
B-->G[2.96]
")
```


Using this very general definition of the word _simulation_, I see the following analysis techinques as a type of simulation. 

```{r, echo=FALSE}
DiagrammeR::mermaid("
graph TB
sq[Simulation] --> ci[Bootstrap]
sq --> A[Cross Validation]
sq --> B[Sensitivity Analysis]
sq --> C[Permutations]
classDef green fill:#9f6,stroke:#333,stroke-width:2px;
classDef orange fill:#f96,stroke:#333,stroke-width:4px;
class sq green
")
```





<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Biostatistics in R</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="These are a collection of tutorials that I have found useful in statistical applications.">
  <meta name="generator" content="bookdown 0.0.64 and GitBook 2.6.7">

  <meta property="og:title" content="Biostatistics in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are a collection of tutorials that I have found useful in statistical applications." />
  <meta name="github-repo" content="sahirbhatnagar/biosR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Biostatistics in R" />
  
  <meta name="twitter:description" content="These are a collection of tutorials that I have found useful in statistical applications." />
  

<meta name="author" content="Sahir Rai Bhatnagar">

<meta name="date" content="2016-04-15">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="simulations.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Biostatistics in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="vectorization-apply-and-for-loops.html"><a href="vectorization-apply-and-for-loops.html"><i class="fa fa-check"></i><b>2</b> Vectorization, *apply and for loops</a><ul>
<li class="chapter" data-level="2.1" data-path="vectorization-apply-and-for-loops.html"><a href="vectorization-apply-and-for-loops.html#vectorization"><i class="fa fa-check"></i><b>2.1</b> Vectorization</a></li>
<li class="chapter" data-level="2.2" data-path="vectorization-apply-and-for-loops.html"><a href="vectorization-apply-and-for-loops.html#family-of-apply-functions"><i class="fa fa-check"></i><b>2.2</b> Family of <code>*apply</code> functions</a><ul>
<li class="chapter" data-level="2.2.1" data-path="vectorization-apply-and-for-loops.html"><a href="vectorization-apply-and-for-loops.html#loops-vs.apply"><i class="fa fa-check"></i><b>2.2.1</b> Loops vs.Â Apply</a></li>
<li class="chapter" data-level="2.2.2" data-path="vectorization-apply-and-for-loops.html"><a href="vectorization-apply-and-for-loops.html#descriptive-statistics-using-apply"><i class="fa fa-check"></i><b>2.2.2</b> Descriptive Statistics using <code>*apply</code></a></li>
<li class="chapter" data-level="2.2.3" data-path="vectorization-apply-and-for-loops.html"><a href="vectorization-apply-and-for-loops.html#creating-new-columns-using-sapply"><i class="fa fa-check"></i><b>2.2.3</b> Creating new columns using <code>sapply</code></a></li>
<li class="chapter" data-level="2.2.4" data-path="vectorization-apply-and-for-loops.html"><a href="vectorization-apply-and-for-loops.html#applying-functions-to-subsets-using-tapply"><i class="fa fa-check"></i><b>2.2.4</b> Applying functions to subsets using <code>tapply</code></a></li>
<li class="chapter" data-level="2.2.5" data-path="vectorization-apply-and-for-loops.html"><a href="vectorization-apply-and-for-loops.html#nested-for-loops-using-mapply"><i class="fa fa-check"></i><b>2.2.5</b> Nested for loops using <code>mapply</code></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="vectorization-apply-and-for-loops.html"><a href="vectorization-apply-and-for-loops.html#creating-dynamic-documents-with-mapply"><i class="fa fa-check"></i><b>2.3</b> Creating dynamic documents with <code>mapply</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="simulations.html"><a href="simulations.html"><i class="fa fa-check"></i><b>3</b> Simulations</a></li>
<li class="chapter" data-level="4" data-path="placeholder.html"><a href="placeholder.html"><i class="fa fa-check"></i><b>4</b> Placeholder</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Biostatistics in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="vectorization-apply-and-for-loops" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Vectorization, *apply and for loops</h1>
<p>This section will cover the basics of vectorizations, the <code>*apply</code> family of functions and <code>for</code> loops.</p>
<div id="vectorization" class="section level2">
<h2><span class="header-section-number">2.1</span> Vectorization</h2>
<p>Almost everything in <code>R</code> is a vector. A scalar is really a vector of length 1 and a <code>data.frame</code> is a collection of vectors. An nice feature of  is its vectorized capabilities. Vectorization indicates that a function operates on a whole vector of values at the same time and not just on a single value<a href="placeholder.html#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>. If you have have ever taken a basic linear algebra course, this concept will be familiar to you.  Take for example two vectors:  <span class="math display">\[
\begin{bmatrix} 1 \\ 2 \\ 3 \end{bmatrix} + 
\begin{bmatrix} 1 \\ 2 \\ 3 \end{bmatrix} =
\begin{bmatrix} 2 \\ 4 \\ 6 \end{bmatrix}
\]</span>  The corresponding <code>R</code> code is given by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)
b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)
a+b</code></pre></div>
<pre><code>## [1] 2 4 6</code></pre>
<p>Many of the <code>base</code> functions in <code>R</code> are already vectorized. Here are some common examples:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate a sequence of numbers from 1 to 10</span>
(a &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">10</span>)</code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sum the numbers from 1 to 10</span>
<span class="kw">sum</span>(a)</code></pre></div>
<pre><code>## [1] 55</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate sums of each column</span>
<span class="kw">colSums</span>(iris[, -<span class="dv">5</span>])</code></pre></div>
<pre><code>## Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
##        876.5        458.6        563.7        179.9</code></pre>
<blockquote>
<p><strong>Exercise</strong>: What happens when you sum two vectors of different lengths?</p>
</blockquote>
</div>
<div id="family-of-apply-functions" class="section level2">
<h2><span class="header-section-number">2.2</span> Family of <code>*apply</code> functions</h2>
<ul>
<li><code>apply</code>, <code>lapply</code> and <code>sapply</code> are some of the most commonly used class of functions in <code>R</code></li>
<li><code>*apply</code> functions are not necessarily faster than loops, but can be easier to read (and vice cersa)</li>
<li><code>apply</code> is used when you need to perform an operation on every row or column of a matrix or data.frame</li>
<li><code>lapply</code> and <code>sapply</code> differ in the format of the output. The former returns a list while the ladder returns a vector</li>
<li>There are other <code>*apply</code> functions such as <code>tapply</code>, <code>vapply</code> and <code>mapply</code> with similar functionality and purpose</li>
</ul>
<div id="loops-vs.apply" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Loops vs.Â Apply</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Getting the row means of two columns</span>
<span class="co"># Generate data</span>
N &lt;-<span class="st"> </span><span class="dv">10000</span>
x1 &lt;-<span class="st"> </span><span class="kw">runif</span>(N)
x2 &lt;-<span class="st"> </span><span class="kw">runif</span>(N)
d &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(x1, x2))
<span class="kw">head</span>(d)</code></pre></div>
<pre><code>##          x1         x2
## 1 0.7775907 0.05426602
## 2 0.2052145 0.21540696
## 3 0.2196830 0.34425887
## 4 0.9933917 0.53337152
## 5 0.8339855 0.38206796
## 6 0.6706090 0.34860205</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Loop:</span>
<span class="co"># create a vector to store the results in </span>
rowMeanFor &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, N)

for (i in <span class="kw">seq_len</span>(N)) {
        rowMeanFor[[i]] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">c</span>(d[i, <span class="dv">1</span>], d[i, <span class="dv">2</span>]))
}

<span class="co"># Apply:</span>
rowMeanApply &lt;-<span class="st"> </span><span class="kw">apply</span>(d, <span class="dv">1</span>, mean)

<span class="co"># are the results equal</span>
<span class="kw">all.equal</span>(rowMeanFor,rowMeanApply)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="descriptive-statistics-using-apply" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Descriptive Statistics using <code>*apply</code></h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(women)
<span class="co"># data structure</span>
<span class="kw">str</span>(women)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    15 obs. of  2 variables:
##  $ height: num  58 59 60 61 62 63 64 65 66 67 ...
##  $ weight: num  115 117 120 123 126 129 132 135 139 142 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate the mean for each column</span>
<span class="kw">apply</span>(women, <span class="dv">2</span>, mean)</code></pre></div>
<pre><code>##   height   weight 
##  65.0000 136.7333</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># apply &#39;fivenum&#39; function to each column</span>
<span class="kw">vapply</span>(women, fivenum, <span class="kw">c</span>(<span class="st">&quot;Min.&quot;</span> =<span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;1st Qu.&quot;</span> =<span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;Median&quot;</span> =<span class="st"> </span><span class="dv">0</span>, 
                         <span class="st">&quot;3rd Qu.&quot;</span> =<span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;Max.&quot;</span> =<span class="st"> </span><span class="dv">0</span>))</code></pre></div>
<pre><code>##         height weight
## Min.      58.0  115.0
## 1st Qu.   61.5  124.5
## Median    65.0  135.0
## 3rd Qu.   68.5  148.0
## Max.      72.0  164.0</code></pre>
</div>
<div id="creating-new-columns-using-sapply" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Creating new columns using <code>sapply</code></h3>
<p>You can apply a <em>user defined function</em> to columns or the entire data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the ouput of sapply is a vector</span>
<span class="co"># the &#39;s&#39; in sapply stands for &#39;simplified&#39; apply</span>
mtcars$gear2 &lt;-<span class="st"> </span><span class="kw">sapply</span>(mtcars$gear, 
                       function(i) if (i==<span class="dv">4</span>) <span class="st">&quot;alot&quot;</span> else <span class="st">&quot;some&quot;</span>)

<span class="kw">head</span>(mtcars)[,<span class="kw">c</span>(<span class="st">&quot;gear&quot;</span>,<span class="st">&quot;gear2&quot;</span>)]</code></pre></div>
<pre><code>##                   gear gear2
## Mazda RX4            4  alot
## Mazda RX4 Wag        4  alot
## Datsun 710           4  alot
## Hornet 4 Drive       3  some
## Hornet Sportabout    3  some
## Valiant              3  some</code></pre>
</div>
<div id="applying-functions-to-subsets-using-tapply" class="section level3">
<h3><span class="header-section-number">2.2.4</span> Applying functions to subsets using <code>tapply</code></h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fisher&#39;s famous dataset </span>
<span class="kw">data</span>(iris)
<span class="kw">str</span>(iris)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  5 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># mean sepal length by species </span>
<span class="kw">tapply</span>(iris$Sepal.Length, iris$Species, mean)</code></pre></div>
<pre><code>##     setosa versicolor  virginica 
##      5.006      5.936      6.588</code></pre>
</div>
<div id="nested-for-loops-using-mapply" class="section level3">
<h3><span class="header-section-number">2.2.5</span> Nested for loops using <code>mapply</code></h3>
<p><code>mapply</code> is my favorite <code>base</code> <code>R</code> function and here are some reasons why:</p>
<ul>
<li>Using <code>mapply</code> is equivalent to writing nested <code>for</code> loops except that it is 100% more human readable and less prone to errors</li>
<li>It is an effective way of conducting simulations because it iterates of many arguments</li>
</ul>
<p>Letâs say you want to generate random samples from a normal distribution with varying means and standard deviations. Of course the brute force way would be to write out the command once, copy paste as many times as you want, and then manually change the arguments for <code>mean</code> and <code>sd</code> in the <code>rnorm</code> function as so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">5</span>, <span class="dt">sd =</span> <span class="dv">1</span>)
v2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">5</span>)
v3 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dt">mean =</span> -<span class="dv">3</span>, <span class="dt">sd =</span> <span class="dv">10</span>)</code></pre></div>
<p>This isnât too bad for three vectors. But what if you want to generate many more combinations of means and sds ? Furthermore, how can you keep track of the parameters you used? Now lets consider the <code>mapply</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">means &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,-<span class="dv">3</span>) ; sds &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>) 

<span class="co"># MoreArgs is a list of arguments that dont change</span>
randomNormals &lt;-<span class="st"> </span><span class="kw">mapply</span>(rnorm, <span class="dt">mean =</span> means, <span class="dt">sd =</span> sds, 
                        <span class="dt">MoreArgs =</span> <span class="kw">list</span>(<span class="dt">n =</span> <span class="dv">100</span>))

<span class="kw">head</span>(randomNormals)</code></pre></div>
<pre><code>##          [,1]      [,2]         [,3]
## [1,] 4.753897  6.337325 -28.95065069
## [2,] 5.848340  4.986695  -0.03084505
## [3,] 6.425455 10.595238  -2.99559990
## [4,] 4.197796 12.516972 -13.80267242
## [5,] 5.600156 12.599777   4.33072116
## [6,] 7.041694 13.356839  10.17859115</code></pre>
<p>The following diagram (from <a href="http://r4ds.had.co.nz/iteration.html#mapping-over-multiple-arguments">r4ds</a>) describes exactly what is going on in the above function call to <code>mapply</code>:</p>
<p><img src="images/mapply.png" alt="" /><!-- --></p>
<p>Advantages:</p>
<ol style="list-style-type: decimal">
<li>Result is automatically stored in a matrix</li>
<li>The parameters are also saved in <code>R</code> objects so that they can be easily manipulated and/or recovered</li>
</ol>
<p>Consider a more complex scenario where you want to consider many possible combinations of means and sds. We take advantage of the <code>expand.grid</code> function to create a <code>data.frame</code> of simulation parameters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simParams &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">means =</span> <span class="dv">1</span>:<span class="dv">10</span>,
                         <span class="dt">sds =</span> <span class="dv">1</span>:<span class="dv">10</span>)

randomNormals &lt;-<span class="st"> </span><span class="kw">mapply</span>(rnorm, <span class="dt">mean =</span> simParams$means, 
                        <span class="dt">sd =</span> simParams$sds, 
                        <span class="dt">MoreArgs =</span> <span class="kw">list</span>(<span class="dt">n =</span> <span class="dv">100</span>))

<span class="kw">dim</span>(randomNormals)</code></pre></div>
<pre><code>## [1] 100 100</code></pre>
</div>
</div>
<div id="creating-dynamic-documents-with-mapply" class="section level2">
<h2><span class="header-section-number">2.3</span> Creating dynamic documents with <code>mapply</code></h2>
<p>Save the following code in a file called <code>template.Rnw</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="simulations.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sahirbhatnagar/biosR/edit/master/01-loops.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
